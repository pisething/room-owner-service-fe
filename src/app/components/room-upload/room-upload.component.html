<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Upload Rooms from Excel</h3>
    <button type="button"
            class="btn btn-outline-secondary btn-sm"
            (click)="goBack()">
      ‚Üê Back to list
    </button>
  </div>

  <div class="card">
    <div class="card-body">

      <!-- Form -->
      <form (ngSubmit)="submit()">
        <div class="mb-3">
          <label class="form-label">Excel File *</label>
          <input type="file"
                 class="form-control"
                 (change)="onFileChange($event)"
                 accept=".xlsx,.xls" />

          <div class="form-text">
            Supported: .xlsx, .xls
          </div>

          @if (fileError) {
            <div class="text-danger mt-1">
              {{ fileError }}
            </div>
          }
        </div>

        <div class="form-check mb-3">
          <input class="form-check-input"
                 type="checkbox"
                 id="dryRun"
                 [(ngModel)]="dryRun"
                 name="dryRun">
          <label class="form-check-label" for="dryRun">
            Dry run (validate only, do not save)
          </label>
        </div>

        <button type="submit"
                class="btn btn-primary"
                [disabled]="!selectedFile || loading">

          @if (!loading) {
            <span>Upload</span>
          } @else {
            <span>Uploading...</span>
          }

        </button>
      </form>

      <!-- Error message -->
      @if (error) {
        <div class="alert alert-danger mt-3">
          {{ error }}
        </div>
      }

      <!-- Summary -->
      @if (summary) {
        <div class="mt-4">
          <h5>Upload Summary</h5>

          <ul class="list-group mb-3">
            <li class="list-group-item">
              Total rows: <strong>{{ summary.total }}</strong>
            </li>
            <li class="list-group-item">
              Inserted: <strong class="text-success">{{ summary.inserted }}</strong>
            </li>
            <li class="list-group-item">
              Validation errors: <strong class="text-danger">{{ summary.validationErrors }}</strong>
            </li>
            <li class="list-group-item">
              Duplicate errors: <strong class="text-danger">{{ summary.duplicateErrors }}</strong>
            </li>
            <li class="list-group-item">
              Other errors: <strong class="text-danger">{{ summary.otherErrors }}</strong>
            </li>
          </ul>

          <!-- Row errors -->
          @if (summary.errors.length) {
            <h6>Row details</h6>
            <div class="table-responsive">
              <table class="table table-sm table-bordered align-middle mb-0">
                <thead>
                  <tr>
                    <th style="width: 80px;">Row #</th>
                    @if (summary.errors[0].errorType) {
                      <th style="width: 120px;">Type</th>
                    }
                    <th>Message</th>
                  </tr>
                </thead>

                <tbody>
                  @for (e of summary.errors; track e.lineNumber) {
                    <tr>
                      <td>{{ e.lineNumber }}</td>

                      @if (e.errorType) {
                        <td>{{ e.errorType }}</td>
                      }

                      <td>{{ e.message }}</td>
                    </tr>
                  }
                </tbody>

              </table>
            </div>
          }
        </div>
      }

    </div>
  </div>
</div>
